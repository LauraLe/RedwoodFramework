[{"pk": 14, "model": "expecon.experiment", "fields": {"name": "RevealedPreferences", "admin_css": ".badge {\r\n  font-size: 13px;\r\n  line-height: 18px;\r\n  padding: 4px 10px 4px;\r\n  vertical-align: middle;\r\n}\r\n\r\n.warning {\r\n  background-color: #fcf8e3 !important;\r\n}", "comments": "", "experimenter": 1, "admin_html": "<!DOCTYPE HTML>\r\n<html ng-app=\"Redwood\">\r\n<head>\r\n  <title>Economics Experiment</title>\r\n  <script type=\"text/javascript\" src=\"{{ STATIC_URL }}framework/js/lib/jquery/jquery.min.js\"></script>\r\n  <script type=\"text/javascript\" src=\"{{ STATIC_URL }}framework/js/lib/bootstrap/bootstrap-3.1.1.min.js\"></script>\r\n  <script type=\"text/javascript\" src=\"{{ STATIC_URL }}framework/js/lib/angular/angular-1.2.16.js\"></script>\r\n\t<script type=\"text/javascript\" src=\"{{ STATIC_URL }}framework/js/redwoodCore.js\"></script>\r\n\t<script type=\"text/javascript\" src=\"{{ STATIC_URL }}framework/js/redwoodHelpers.js\"></script>\r\n\t<script type=\"text/javascript\" src=\"{{ STATIC_URL }}framework/js/redwoodAdmin.js\"></script>\r\n\t<link type=\"text/css\" rel=\"stylesheet\" href=\"{{ STATIC_URL }}framework/css/bootstrap.min.css\"></link>\r\n\t<script type=\"text/javascript\">\r\n\t\t{{ js }}\r\n\t</script>\r\n\t<style type=\"text/css\">\r\n\t\t{{ css }}\r\n\t</style>\r\n</head>\r\n<body ng-controller=\"AdminCtrl\" style=\"padding-top:60px;\">\r\n\r\n<div class=\"navbar navbar-fixed-top container\">\r\n\t<div class=\"navbar-inner\">\r\n\t\t<div class=\"container-fluid\">\r\n\t\t\t<div class=\"brand\" href=\"#\">Economics Experiment</div>\r\n\t\t\t<div class=\"nav-collapse collapse\">\r\n\t\t\t\t<p class=\"navbar-text pull-right\">Administrator</p>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n\r\n<div class=\"container\">\r\n\t<div class=\"row\">\r\n\t\t<div class=\"span3\">\r\n\t\t\t<div class=\"row\">\r\n\t\t\t\t<div class=\"span3\">\r\n\t\t\t\t\t<div class=\"well sidebar-nav\">\r\n\t\t\t\t\t\t<ul class=\"nav nav-list\">\r\n\t\t\t\t\t\t\t<li><span id=\"router-status\" class=\"badge badge-important\"></span></li>\r\n\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"row\">\r\n\t\t\t\t<div class=\"span3\">\r\n\t\t\t\t\t<div class=\"well sidebar-nav\">\r\n\t\t\t\t\t\t<ul class=\"nav nav-list\">\r\n\t\t\t\t\t\t\t<li><a href=\"admin/payouts\" target=\"_blank\">View Payouts</a></li>\r\n\t\t\t\t\t\t\t<li><a id=\"archive\" href=\"#\">Archive Session</a></li>\r\n\t\t\t\t\t\t\t<li><a id=\"download\" href=\"admin/download\">Download Data</a></li>\r\n\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<div class=\"span9\">\r\n\t\t\t<div class=\"row\">\r\n\t\t\t\t<div class=\"span9\">\r\n\t\t\t\t\t<p>Subjects:</p>\r\n\t\t\t\t\t<table class=\"table table-bordered table-condensed table-striped\">\r\n\t\t\t\t\t\t<thead>\r\n\t\t\t\t\t\t<tr><th>ID</th><th>Group</th><th>Period</th><th style=\"width: 150px;\"></th></tr>\r\n\t\t\t\t\t\t</thead>\r\n\t\t\t\t\t\t<tbody id=\"subject-list\">\r\n\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t</table>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"row\">\r\n\t\t\t\t<div class=\"span6\">\r\n\t\t\t\t\t<button id=\"start-session\" class=\"btn btn-success\">Start Session</button>\r\n\t\t\t\t\t<button id=\"reset-session\" class=\"btn btn-danger\">Reset Session</button>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"span3\">\r\n\t\t\t\t\t<div class=\"pull-right\">\r\n\t\t\t\t\t\t<button id=\"pause-session\" class=\"btn btn-warning\" disabled=\"disabled\">Pause</button>\r\n\t\t\t\t\t\t<button id=\"resume-session\" class=\"btn btn-primary\" disabled=\"disabled\">Resume</button>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n\t<div class=\"row\">\r\n\t\t<div class=\"span12\">\r\n\t\t\t<hr/>\r\n\t\t\t<p>Configuration:</p>\r\n\t\t\t<load-config></load-config>\r\n\t\t\t<div style=\"overflow: auto;\">\r\n\t\t\t\t<table class=\"config table table-bordered table-striped table-condensed\"></table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n\r\n</body>\r\n</html>\r\n", "admin_js": "Redwood.controller(\"AdminCtrl\", [\"$rootScope\", \"$scope\", \"Admin\", function($rootScope, $scope, ra) {\r\n  var Display = { //Display controller\r\n\r\n    initialize: function() {\r\n\t\t\t$(\"#start-session\").click(function () {\r\n\t\t\t\t$(\"#start-session\").attr(\"disabled\", \"disabled\");\r\n\t\t\t\tra.trigger(\"start_session\");\r\n\t\t\t});\r\n\r\n\t\t\tra.on(\"start_session\", function() {\r\n\t\t\t\t$(\"#start-session\").attr(\"disabled\", \"disabled\");\r\n\t\t\t\t$(\"#pause-session\").removeAttr(\"disabled\");\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#reset-session\").click(function () {\r\n\t\t\t\tra.reset();\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#pause-session\").click(function () {\r\n\t\t\t\t$(\"#pause-session\").attr(\"disabled\", \"disabled\");\r\n\t\t\t\tra.trigger(\"pause\");\r\n\t\t\t});\r\n\t\t\tra.on(\"pause\", function() {\r\n\t\t\t\t$(\"#pause-session\").attr(\"disabled\", \"disabled\");\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#resume-session\").click(function () {\r\n\t\t\t\t$(\"#resume-session\").attr(\"disabled\", \"disabled\");\r\n\t\t\t\tra.trigger(\"resume\");\r\n\t\t\t});\r\n\t\t\tra.on(\"resume\", function() {\r\n\t\t\t\t$(\"#resume-session\").attr(\"disabled\", \"disabled\");\r\n\t\t\t\t$(\"#pause-session\").removeAttr(\"disabled\");\r\n\t\t\t});\r\n\r\n\t\t\tra.on_subject_paused(function(userId) {\r\n\t\t\t\t$(\"#pause-session\").attr(\"disabled\", \"disabled\");\r\n\t\t\t\t$(\"tr.subject-\" + userId).addClass(\"warning\"); //Display current period for each user\r\n\t\t\t\t$(\"tr.subject-\" + userId + \" :nth-child(4)\").text(\"Paused\"); //Display current period for each user\r\n\t\t\t});\r\n\r\n\t\t\tra.on_all_paused(function() {\r\n\t\t\t\t$(\"#resume-session\").removeAttr(\"disabled\");\r\n\t\t\t});\r\n\r\n\t\t\tra.on_subject_resumed(function(user) {\r\n\t\t\t\t$(\"tr.subject-\" + user).removeClass(\"warning\"); //Display current period for each user\r\n\t\t\t\t$(\"tr.subject-\" + user + \" :nth-child(4)\").text(\"\"); //Display current period for each user\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#archive\").click(function () {\r\n\t\t\t\tvar r = confirm(\"Are you sure you want to archive this session?\");\r\n\t\t\t\tif(r == true) {\r\n\t\t\t\t\tra.delete_session();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tra.on_router_connected(function(connected) { //Display router connection status\r\n\t\t\t\tvar status = $(\"#router-status\");\r\n\t\t\t\tif (connected) {\r\n\t\t\t\t\tstatus.text(\"Router Connected\");\r\n\t\t\t\t\tstatus.removeClass(\"badge-important\");\r\n\t\t\t\t\tstatus.addClass(\"badge-success\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\tstatus.text(\"Router Disconnected\");\r\n\t\t\t\t\tstatus.removeClass(\"badge-success\");\r\n\t\t\t\t\tstatus.addClass(\"badge-important\");\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tra.on_set_period(function(user, period) {\r\n\t\t\t\t$(\"tr.subject-\" + user + \" :nth-child(3)\").text(period); //Display current period for each user\r\n\t\t\t});\r\n\r\n\t\t\tra.on_set_group(function(user, group) {\r\n\t\t\t\t$(\"tr.subject-\" + user + \" :nth-child(2)\").text(group); //Display group for each user\r\n\t\t\t});\r\n\r\n\t\t\tra.on_register(function(user) { //Add a row to the table to each user\r\n\t\t\t\t$(\"#subject-list\").empty();\r\n\t\t\t\tfor(var i = 0, l = ra.subjects.length; i < l; i++) {\r\n\t\t\t\t\t$(\"#subject-list\").append($(\"<tr>\").addClass(\"subject-\" + ra.subjects[i].user_id).append(\r\n\t\t\t\t\t\t$(\"<td>\").text(ra.subjects[i].user_id).after(\r\n\t\t\t\t\t\t\t$(\"<td>\").text(0).after(\r\n\t\t\t\t\t\t\t\t$(\"<td>\").text(0).after(\r\n\t\t\t\t\t\t\t\t\t$(\"<td>\").text(\"\"))))));\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tra.on_set_config(function(config) { //Display the config file\r\n\t\t\t\t$(\"table.config\").empty();\r\n\t\t\t\tvar a = $.csv.toArrays(config);\r\n\t\t\t\tfor (var i = 0; i < a.length; i++) {\r\n\t\t\t\t\tvar row = a[i];\r\n\t\t\t\t\tvar tr = $(\"<tr>\");\r\n\t\t\t\t\tfor (var j = 0; j < row.length; j++) {\r\n\t\t\t\t\t\tvar cell = row[j];\r\n\t\t\t\t\t\tvar td = $((i == 0 ? \"<th>\" : \"<td>\")).text(cell);\r\n\t\t\t\t\t\ttr.append(td);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t$(\"table.config\").append(tr);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\r\n\r\n\tvar resetGroups = function() {\r\n\t\tvar config = ra.get_config(1, 0);\r\n\t\tfor (var i = 0; i < ra.subjects.length; i++) { //set all subjects to group 1 (this is so that matching can be changed per period)\r\n\t\t\tif($.isArray(config.groups)) {\r\n\t\t\t\tfor(var groupId = 0; groupId < config.groups.length; groupId++) {\r\n\t\t\t\t\tif($.isArray(config.groups[groupId])) {\r\n\t\t\t\t\t\tif(config.groups[groupId].indexOf(parseInt(ra.subjects[i].user_id)) > -1) { //Nested group array\r\n\t\t\t\t\t\t\tra.set_group(groupId + 1, ra.subjects[i].user_id);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tra.set_group(1, ra.subjects[i].user_id);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tra.set_group(1, ra.subjects[i].user_id);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tDisplay.initialize();\r\n\r\n\tra.on_load(function () {\r\n\t\tresetGroups(); //Assign groups to users\r\n\t});\r\n\r\n\tra.on_register(function(user) { //Add a row to the table to each user\r\n\t\tresetGroups();\r\n\t});\r\n\r\n\tra.on(\"start_session\", function() {\r\n\t\tra.start_session();\r\n\t});\r\n\r\n\tra.on(\"pause\", function() {\r\n\t\tra.pause();\r\n\t});\r\n\r\n\tra.on(\"resume\", function() {\r\n\t\tra.resume();\r\n\t});\r\n\r\n}]);\r\n", "rt_js": ""}}, {"pk": 38, "model": "expecon.page", "fields": {"experiment": 14, "html": "{% load verbatim %}\r\n<!DOCTYPE HTML>\r\n<html ng-app=\"Redwood\">\r\n<head>\r\n  <title>Wait</title>\r\n  <script type=\"text/javascript\" src=\"{{ STATIC_URL }}framework/js/lib/jquery/jquery.min.js\"></script>\r\n  <script type=\"text/javascript\" src=\"{{ STATIC_URL }}framework/js/lib/bootstrap/bootstrap-3.1.1.min.js\"></script>\r\n  <script type=\"text/javascript\" src=\"{{ STATIC_URL }}framework/js/lib/angular/angular-1.2.16.js\"></script>\r\n  <script type=\"text/javascript\" src=\"{{ STATIC_URL }}framework/js/redwoodCore.js\"></script>\r\n\t<script type=\"text/javascript\" src=\"{{ STATIC_URL }}framework/js/redwoodHelpers.js\"></script>\r\n\t<script type=\"text/javascript\" src=\"{{ STATIC_URL }}framework/js/redwoodSubject.js\"></script>\r\n\t<link type=\"text/css\" rel=\"stylesheet\" href=\"{{ STATIC_URL }}framework/css/bootstrap-3.1.1.min.css\"></link>\r\n  <script type=\"text/javascript\">\r\n\t\tvar IMAGE_URL = \"{{ STATIC_URL }}/img/Ultimatum\";\r\n\t\t{{ js }}\r\n\t</script>\r\n\t<style type=\"text/css\">\r\n\t\t{{ css }}\r\n\t</style>\r\n</head>\r\n{% verbatim %}\r\n<body ng-controller=\"SubjectCtrl\">\r\n\t\r\n\t<div class=\"navbar navbar-fixed-top container\">\r\n  <div class=\"navbar navbar-default\" style=\"margin-bottom: 0;\">\r\n\t\t<div class=\"navbar-brand\" href=\"#\">Economics Experiment</div>\r\n\t\t<ul class=\"nav navbar-nav\">\r\n\t\t\t<li class=\"active\">\r\n\t\t\t\t<a>User ID: <span>{{$root.user_id}}</span></a>\r\n\t\t\t</li>\r\n\t\t</ul>\r\n\t</div>\r\n</div>\r\n\t\r\n\t<div class=\"container\">\r\n\t\t<div class=\"row\">\r\n\t\t\t<div class=\"col-lg-12\">\r\n\t\t\t\tPlease wait for experiment to start...\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n</body>\r\n{% endverbatim %}\r\n</html>\r\n", "name": "Wait", "css": "body {\r\n  padding-top: 60px;\r\n}", "js": "Redwood.controller(\"SubjectCtrl\", [\"$rootScope\", \"$scope\", \"RedwoodSubject\", function($rootScope, $scope, rs) {\r\n  rs.on_load(function() { //called once the page has loaded for a new sub period\r\n    rs.next_period();\r\n\t});\r\n}]);"}}, {"pk": 39, "model": "expecon.page", "fields": {"experiment": 14, "html": "{% load verbatim %}\r\n<!DOCTYPE HTML>\r\n<html ng-app=\"Redwood\">\r\n<head>\r\n  <title>Start</title>\r\n\t<script type=\"text/javascript\" src=\"{{ STATIC_URL }}framework/js/lib/jquery/jquery.min.js\"></script>\r\n\t<script type=\"text/javascript\" src=\"{{ STATIC_URL }}framework/js/lib/flot/jquery.flot.js\"></script>\r\n\t<script type=\"text/javascript\" src=\"{{ STATIC_URL }}framework/js/lib/flot/jquery.flot.dashes.js\"></script>\r\n\t<script type=\"text/javascript\" src=\"{{ STATIC_URL }}framework/js/lib/jquery/jquery-ui-1.10.3.custom.js\"></script>\r\n  <script type=\"text/javascript\" src=\"{{ STATIC_URL }}framework/js/lib/bootstrap/bootstrap-3.1.1.min.js\"></script>\r\n  <script type=\"text/javascript\" src=\"{{ STATIC_URL }}framework/js/lib/angular/angular-1.2.16.js\"></script>\r\n  <script type=\"text/javascript\" src=\"{{ STATIC_URL }}framework/js/redwoodCore.js\"></script>\r\n  <script type=\"text/javascript\" src=\"{{ STATIC_URL }}framework/js/redwoodHelpers.js\"></script>\r\n\t<script type=\"text/javascript\" src=\"{{ STATIC_URL }}framework/js/redwoodSubject.js\"></script>\r\n  <link type=\"text/css\" rel=\"stylesheet\" href=\"{{ STATIC_URL }}framework/css/bootstrap-3.1.1.min.css\"></link>\r\n\t<link type=\"text/css\" rel=\"stylesheet\" href=\"{{ STATIC_URL }}framework/css/ui-lightness/jquery-ui-1.10.3.custom.css\"></link>\r\n\t<script type=\"text/javascript\">\r\n\t\tvar IMAGE_URL = \"{{ STATIC_URL }}/img/Ultimatum\";\r\n\t\t{{ js }}\r\n\t</script>\r\n\t<style type=\"text/css\">\r\n\t\t{{ css }}\r\n\t</style>\r\n</head>\r\n\r\n{% verbatim %}\r\n<body ng-controller=\"SubjectCtrl\" style=\"padding-top:60px;\">\r\n\t\r\n\t<div class=\"navbar navbar-fixed-top container\">\r\n  <div class=\"navbar navbar-default\" style=\"margin-bottom: 0;\">\r\n\t\t<div class=\"navbar-brand\" href=\"#\">Economics Experiment</div>\r\n\t\t<ul class=\"nav navbar-nav\">\r\n\t\t\t<li class=\"active\">\r\n\t\t\t\t<a>User ID: <span>{{$root.user_id}}</span></a>\r\n\t\t\t</li>\r\n\t\t</ul>\r\n\t\t<div class=\"navbar-right\">\r\n\t\t\t<div class=\"navbar-text\">Period: <span>{{$root.period}}</span></div>\r\n\t\t\t<div class=\"navbar-text\">Total Reward: <span>{{$root.totalPoints | number:2}}</span></div>\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n\t\r\n\t<div class=\"container\">\r\n\t\t<div class=\"row\">\r\n\t\t\t<div class=\"col-lg-3\">\r\n\t\t\t\t<div class=\"well sidebar-nav\">\r\n\t\t\t\t\t<ul class=\"nav nav-list\">\r\n\t\t\t\t\t\t<li>Period:<span name=\"data-period\" class=\"pull-right\"></span></li>\r\n\t\t\t\t\t\t<li>Round:<span name=\"round\" class=\"pull-right\"></span></li>\r\n\t\t\t\t\t</ul>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"col-lg-9\">\r\n\t\t\t\t<div class=\"row\">\r\n\t\t\t\t\t<div class=\"col-lg-1\">\r\n\t\t\t\t\t\t<div style=\"display:table-cell; height:540px; vertical-align:middle;\">\r\n\t\t\t\t\t\t\t<div class=\"rotate90\" style=\"max-width:60px;\">\r\n\t\t\t\t\t\t\t\t<div style=\"display:inline-block; text-align:center; white-space:nowrap;\">Number of Y<br/>[Probability of Y: <span id=\"prob-y\"></span>]</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"col-lg-7\">\r\n\t\t\t\t\t\t<div id=\"plot\" style=\"height:540px;\"></div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"row\">\r\n\t\t\t\t\t<div class=\"col-lg-1\"></div>\r\n\t\t\t\t\t<div class=\"col-lg-8\">\r\n\t\t\t\t\t\t<div style=\"text-align:center;\"><div style=\"display:inline-block;\">Number of X<br/>[Probability of X: <span id=\"prob-x\"></span>]</div></div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"row\">\r\n\t\t\t\t\t<div class=\"col-lg-1\"></div>\r\n\t\t\t\t\t<div class=\"col-lg-8\">\r\n\t\t\t\t\t\t<button id=\"confirm-button\" class=\"btn btn-success\" disabled=\"disabled\">Ready</button>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<div class=\"row\">\r\n\t\t\t<hr style=\"margin-top:20px;\"/>\r\n\t\t\t<div class=\"col-lg-12\" id=\"footer\">\r\n\t\t\t\t\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n</body>\r\n{% endverbatim %}\r\n</html>\r\n", "name": "Start", "css": ".rotate90 {\r\n  -moz-transform: rotate(-90.0deg);  /* FF3.5+ */\r\n  -o-transform: rotate(-90.0deg);  /* Opera 10.5 */\r\n  -webkit-transform: rotate(-90.0deg);  /* Saf3.1+, Chrome */\r\n}", "js": "Redwood.controller(\"SubjectCtrl\", [\"$rootScope\", \"$scope\", \"RedwoodSubject\", function($rootScope, $scope, rs) {\r\n  \r\n  var state = {}; //State object\r\n\r\n\tvar Display = { //Display controller\r\n\r\n\t\tinitialize: function() {\r\n\r\n\t\t\t$(\"#prob-x\").text(state.config.ProbX);\r\n\t\t\t$(\"#prob-y\").text(1 - state.config.ProbX);\r\n\r\n\t\t\trs.on(\"next_round\", function() {\r\n\t\t\t\t$(\"[name='round']\").text(state.round + (state.rounds ? \" / \" + state.rounds : \"\"));\r\n\t\t\t\tDisplay.replot();\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#plot\").bind(\"plothover\", function (event, pos, item) {\r\n\t\t\t\tif(!state.inputsEnabled) return;\r\n\t\t\t\tvar x = Math.max(0, pos.x);\r\n\t\t\t\tx = Math.min(state.maxX, x);\r\n\t\t\t\tvar y = (state.budget - (x * state.Px)) / state.config.Py;\r\n\t\t\t\tstate.cursor = [x, y];\r\n\t\t\t\tDisplay.replot();\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#plot\").bind(\"plotclick\", function (event, pos, item) {\r\n\t\t\t\tif(!state.inputsEnabled) return;\r\n\t\t\t\tvar x = Math.max(0, pos.x);\r\n\t\t\t\tx = Math.min(state.maxX, x);\r\n\t\t\t\tvar y = (state.budget - (x * state.Px)) / state.config.Py;\r\n\t\t\t\trs.trigger(\"selection\", [x, y]);\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#plot\").bind(\"mouseout\", function (event) {\r\n\t\t\t\tif(!state.inputsEnabled) return;\r\n\t\t\t\tstate.cursor = undefined;\r\n\t\t\t\tDisplay.replot();\r\n\t\t\t});\r\n\r\n\t\t\trs.on(\"selection\", function() {\r\n\t\t\t\t$(\"#confirm-button\").removeAttr(\"disabled\");\r\n\t\t\t\tDisplay.replot();\r\n\t\t\t});\r\n\r\n\t\t\t$(\"#confirm-button\").click(function() {\r\n\t\t\t\tif(!state.inputsEnabled) return;\r\n\t\t\t\tif(!state.selection) {\r\n\t\t\t\t\talert(\"Please select a ratio of x and y by clicking on the graph.\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$(\"#confirm-button\").attr(\"disabled\", \"disabled\");\r\n\t\t\t\t\trs.trigger(\"confirm\");\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\trs.on(\"confirm\", function() {\r\n\t\t\t\t$(\"confirm-button\").attr(\"disabled\", \"disabled\");\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\treplot: function() { //Redraw plot area\r\n\r\n\t\t\tvar data = [];\r\n\r\n\t\t\tdata.push([0, state.maxY]);\r\n\t\t\tdata.push([state.maxX, 0]);\r\n\r\n\t\t\tvar dataset = [];\r\n\t\t\tdataset.push({\r\n\t\t\t\tdata: data,\r\n\t\t\t\tlines: { show: true, lineWidth: 1.5 },\r\n\t\t\t\tpoints: { show: false },\r\n\t\t\t\tcolor: \"red\"\r\n\t\t\t});\r\n\r\n\t\t\tif(state.cursor) {\r\n\t\t\t\tdataset.push({ //hollow cursor dot\r\n\t\t\t\t\tdata: [state.cursor],\r\n\t\t\t\t\tlines: { show: false },\r\n\t\t\t\t\tpoints: { show: true, fill: false, radius: 4 },\r\n\t\t\t\t\tcolor: \"black\",\r\n\t\t\t\t\thoverable: false\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(state.showDefault) {\r\n\t\t\t\tdataset.push({ //grey default dot\r\n\t\t\t\t\tdata: [[state.Ex, state.Ey]],\r\n\t\t\t\t\tlines: { show: false },\r\n\t\t\t\t\tpoints: { show: true, lineWidth: 4, fill: true, radius: 3 },\r\n\t\t\t\t\tcolor: \"grey\",\r\n\t\t\t\t\thoverable: false\r\n\t\t\t\t});\r\n\t\t\t\tdataset.push({ //grey default dot\r\n\t\t\t\t\tdata: [[state.Ex, state.Ey]],\r\n\t\t\t\t\tlines: { show: false },\r\n\t\t\t\t\tpoints: { show: true, fill: true, radius: 1 },\r\n\t\t\t\t\tcolor: \"grey\",\r\n\t\t\t\t\thoverable: false\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif(state.selection) {\r\n\t\t\t\tdataset.push({ //black selection dot\r\n\t\t\t\t\tdata: [state.selection],\r\n\t\t\t\t\tlines: { show: false },\r\n\t\t\t\t\tpoints: { show: true, lineWidth: 4, fill: true, radius: 4 },\r\n\t\t\t\t\tcolor: \"black\",\r\n\t\t\t\t\thoverable: false\r\n\t\t\t\t});\r\n\t\t\t\tdataset.push({ //black selection dot\r\n\t\t\t\t\tdata: [state.selection],\r\n\t\t\t\t\tlines: { show: false },\r\n\t\t\t\t\tpoints: { show: true, fill: true, radius: 1 },\r\n\t\t\t\t\tcolor: \"black\",\r\n\t\t\t\t\thoverable: false\r\n\t\t\t\t});\r\n\t\t\t\tif(!state.finalResult) {\r\n\t\t\t\t\tdataset.push({ //dashed selection lines\r\n\t\t\t\t\t\tdata: [[0, state.selection[1]], state.selection, [state.selection[0], 0]],\r\n\t\t\t\t\t\tdashes: { show: true, lineWidth: 1 },\r\n\t\t\t\t\t\tcolor: \"black\",\r\n\t\t\t\t\t\thoverable: false\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(state.finalResult) {\r\n\t\t\t\tvar resultPoint = state.finalResult.chosen === \"x\" ? [state.finalResult.x, 0] : [0, state.finalResult.y];\r\n\t\t\t\tdataset.push({ //green result dot\r\n\t\t\t\t\tdata: [resultPoint],\r\n\t\t\t\t\tlines: { show: false },\r\n\t\t\t\t\tpoints: { show: true, lineWidth: 4, fill: true, radius: 3 },\r\n\t\t\t\t\tcolor: \"green\",\r\n\t\t\t\t\thoverable: false\r\n\t\t\t\t});\r\n\t\t\t\tdataset.push({ //green result dot\r\n\t\t\t\t\tdata: [resultPoint],\r\n\t\t\t\t\tlines: { show: false },\r\n\t\t\t\t\tpoints: { show: true, fill: true, radius: 1 },\r\n\t\t\t\t\tcolor: \"#51a351\",\r\n\t\t\t\t\thoverable: false\r\n\t\t\t\t});\r\n\t\t\t\tdataset.push({ //green result line\r\n\t\t\t\t\tdata: [resultPoint, state.selection],\r\n\t\t\t\t\tdashes: { show: true, lineWidth: 1 },\r\n\t\t\t\t\tcolor: \"#51a351\",\r\n\t\t\t\t\thoverable: false\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tfunction draw_text(plot, ctx) { //display barrier and bankrupt text\r\n\t\t\t\tif(state.cursor) {\r\n\t\t\t\t\tvar offset = plot.pointOffset({ x: state.cursor[0], y: state.cursor[1] });\r\n\t\t\t\t\tvar text = \"[\" + state.cursor[0].toFixed(2) + \", \" + state.cursor[1].toFixed(2) + \"]\";\r\n\t\t\t\t\tctx.fillStyle = \"grey\";\r\n\t\t\t\t\tctx.fillText(text, offset.left + 10, offset.top - 10);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(state.selection) {\r\n\t\t\t\t\tvar offset = plot.pointOffset({ x: state.selection[0], y: state.selection[1] });\r\n\t\t\t\t\tvar text = \"[\" + state.selection[0].toFixed(2) + \", \" + state.selection[1].toFixed(2) + \"]\";\r\n\t\t\t\t\tctx.fillStyle = \"black\";\r\n\t\t\t\t\tctx.fillText(text, offset.left + 10, offset.top - 10);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif(state.showDefault) {\r\n\t\t\t\t\tvar offset = plot.pointOffset({ x: state.Ex, y: state.Ey });\r\n\t\t\t\t\tvar text = \"[\" + state.Ex.toFixed(2) + \", \" + state.Ey.toFixed(2) + \"]\";\r\n\t\t\t\t\tctx.fillStyle = \"grey\";\r\n\t\t\t\t\tctx.fillText(text, offset.left + 10, offset.top - 10);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif(state.finalResult) {\r\n\t\t\t\t\tvar offset = plot.pointOffset({ x: resultPoint[0] , y: resultPoint[1] });\r\n\t\t\t\t\tvar text = \"[\" + (resultPoint[0] || resultPoint[1]).toFixed(2) + \"]\";\r\n\t\t\t\t\tctx.fillStyle = \"#51a351\";\r\n\t\t\t\t\tctx.fillText(text, offset.left + 10, offset.top - 10);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tvar opts = {\r\n\t\t\t\tgrid: { clickable: true, hoverable: true },\r\n\t\t\t\txaxis: { tickLength: 0, min: 0, max: state.xLimit },\r\n\t\t\t\tyaxis: { tickLength: 0, min: 0, max: state.yLimit },\r\n\t\t\t\tseries: { shadowSize: 0 },\r\n\t\t\t\thooks: { draw: [draw_text] }\r\n\t\t\t};\r\n\r\n\t\t\t$.plot(\"#plot\", dataset, opts);\r\n\t\t}\r\n\t};\r\n\r\n\trs.on_load(function() {\r\n\r\n\t\tprocessConfig();\r\n\r\n\t\tDisplay.initialize();\r\n\r\n\t\tif(state.config.referencePeriod) {\r\n\t\t\tvar referenceResult = rs.subject[rs.user_id].data.results.filter(function(result) {\r\n\t\t\t\treturn result.period === state.config.referencePeriod;\r\n\t\t\t})[0];\r\n\t\t\tstate.Ex = referenceResult.x;\r\n\t\t\tstate.Ey = referenceResult.y;\r\n\r\n\t\t} else {\r\n\t\t\tstate.Ex = state.config.Ex;\r\n\t\t\tstate.Ey = state.config.Ey;\r\n\t\t}\r\n\t\t\r\n\t\tstate.showDefault = state.config.enableDefault && state.config.showDefault;\r\n\r\n\t\tstate.rounds = state.config.rounds || 1;\r\n\t\tstate.round = 0;\r\n\t\trs.trigger(\"next_round\");\r\n    console.log(\"test\");\r\n\r\n\t});\r\n\r\n\trs.on(\"next_round\", function() {\r\n\t\t$(\"#confirm-button\").attr(\"disabled\", \"disabled\");\r\n\r\n\t\tif(state.rounds && state.round >= state.rounds) {\r\n\t\t\trs.trigger(\"next_period\");\r\n\t\t\treturn;\r\n\t\t} else if(state.round > 0 && state.config.x_over_y_threshold) {\r\n\t\t\tvar prices = rs.subject[rs.user_id].get(\"prices\");\r\n\t\t\tif(Math.abs(prices.x / prices.y) < state.config.x_over_y_threshold) {\r\n\t\t\t\trs.trigger(\"next_period\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//Begin next round\r\n\t\tstate.round++;\r\n\t\tstate.cursor = undefined;\r\n\t\tstate.selection = undefined;\r\n\t\t\r\n\t\tvar prices = rs.subject[rs.user_id].get(\"prices\");\r\n\t\tstate.Px = state.round > 1 ? prices.x : state.config.Px;\r\n\t\tstate.Py = state.round > 1 ? prices.y : state.config.Py;\r\n\r\n\t\tstate.budget = (state.Ex * state.Px) + (state.Ey * state.config.Py);\r\n\t\tstate.maxX = state.budget / state.Px;\r\n\t\tstate.maxY = state.budget / state.config.Py;\r\n\t\t\r\n\t\tstate.xLimit = state.config.XLimit ? state.config.XLimit : state.maxX;\r\n\t\tstate.yLimit = state.config.YLimit ? state.config.YLimit : state.maxY;\r\n\t\t\r\n\t\tif(state.config.enableDefault) {\r\n\t\t\trs.trigger(\"selection\", [state.Ex, state.Ey]);\r\n\t\t}\r\n\r\n\t\tstate.inputsEnabled = true;\r\n\t});\r\n\r\n\trs.on(\"selection\", function(selection) {\r\n\t\tstate.selection = selection;\r\n\t});\r\n\r\n\trs.on(\"confirm\", function() {\r\n\t\tstate.inputsEnabled = false;\r\n\t\tvar chosen = Math.random() < state.config.ProbX ? \"x\" : \"y\";\r\n\t\trs.trigger(\"result\", { x: state.selection[0], y: state.selection[1], chosen: chosen });\r\n\r\n\t\trs.gate('round_' + state.round, function() {\r\n\t\t\tvar excessDemandX = 0;\r\n\t\t\tvar excessDemandY = 0;\r\n\t\t\trs.subjects.filter(function(subject) {\r\n\t\t\t\t\treturn subject.groupForPeriod && subject.groupForPeriod === rs.subject[rs.user_id].groupForPeriod;\r\n\t\t\t\t}).forEach(function(subject) {\r\n\t\t\t\t\tvar selection = subject.get(\"selection\");\r\n\t\t\t\t\texcessDemandX += selection[0] - state.Ex;\r\n\t\t\t\t\texcessDemandY += selection[1] - state.Ey;\r\n\t\t\t});\r\n\t\t\tvar newPriceX = priceUpdateFormula(state.Px, excessDemandX);\r\n\t\t\tvar newPriceY = priceUpdateFormula(state.Py, excessDemandY);\r\n\t\t\trs.set(\"prices\", { x: newPriceX, y: newPriceY, deltaX: newPriceX - state.Px, deltaY: newPriceY - state.Py });\r\n\t\t\trs.trigger(\"next_round\");\r\n\t\t});\r\n\t});\r\n\r\n\trs.on(\"result\", function(value) {\r\n\t\tif(!state.results) {\r\n\t\t\tstate.results = [];\r\n\t\t}\r\n\t\tstate.results.push(value);\r\n\t});\r\n\r\n\trs.on(\"next_period\", function() {\r\n\t\tvar finalResult = state.results[state.results.length - 1];\r\n\t\tfinalResult.period = rs.period;\r\n\t\trs.set(\"results\", finalResult);\r\n\t\tif(state.config.plotResult) {\r\n\t\t\tstate.finalResult = finalResult;\r\n\t\t\tDisplay.replot();\r\n\t\t\trs.next_period(5);\r\n\t\t} else {\r\n\t\t\trs.next_period();\r\n\t\t}\r\n\t});\r\n\r\n\tvar processConfig = function() {\r\n\t\tvar userIndex = parseInt(rs.user_id) - 1;\r\n\t\tstate.config = {};\r\n\r\n\t\tstate.config.Ex = $.isArray(rs.config.Ex) ? rs.config.Ex[userIndex] : rs.config.Ex;\r\n\t\tstate.config.Ey = $.isArray(rs.config.Ey) ? rs.config.Ey[userIndex] : rs.config.Ey;\r\n\t\tstate.config.Px = $.isArray(rs.config.Px) ? rs.config.Px[userIndex] : rs.config.Px;\r\n\t\tstate.config.Py = $.isArray(rs.config.Py) ? rs.config.Py[userIndex] : rs.config.Py;\r\n\t\tstate.config.Z = $.isArray(rs.config.Z) ? rs.config.Z[userIndex] : rs.config.Z;\r\n\t\tstate.config.XLimit = $.isArray(rs.config.XLimit) ? rs.config.XLimit[userIndex] : rs.config.XLimit;\r\n\t\tstate.config.YLimit = $.isArray(rs.config.YLimit) ? rs.config.YLimit[userIndex] : rs.config.YLimit;\r\n\t\tstate.config.XGrid = $.isArray(rs.config.XGrid) ? rs.config.XGrid[userIndex] : rs.config.XGrid;\r\n\t\tstate.config.YGrid = $.isArray(rs.config.YGrid) ? rs.config.YGrid[userIndex] : rs.config.YGrid;\r\n\t\tstate.config.ProbX = $.isArray(rs.config.ProbX) ? rs.config.ProbX[userIndex] : rs.config.ProbX;\r\n\t\tstate.config.enableDefault = $.isArray(rs.config.enableDefault) ? rs.config.enableDefault[userIndex] : rs.config.enableDefault;\r\n\t\tstate.config.showDefault = $.isArray(rs.config.showDefault) ? rs.config.showDefault[userIndex] : rs.config.showDefault;\r\n\t\tstate.config.plotResult = $.isArray(rs.config.plotResult) ? rs.config.plotResult[userIndex] : rs.config.plotResult;\r\n\t\t\r\n\t\tstate.config.rounds = rs.config.rounds;\r\n\t\tif(rs.config.x_over_y_threshold) {\r\n\t\t\tstate.config.x_over_y_threshold = rs.config.x_over_y_threshold;\r\n\t\t}\r\n\r\n\t\tstate.config.referencePeriod = rs.config.referencePeriod;\r\n\t\tstate.config.pause = rs.config.pause;\r\n\t};\r\n\r\n\tvar priceUpdateFormula = function(currentPrice, excessDemand) {\r\n\t\treturn Math.max(currentPrice + excessDemand * (state.config.Z ? state.config.Z : 0), 0.01);\r\n\t};\r\n\r\n}]);"}}, {"pk": 40, "model": "expecon.page", "fields": {"experiment": 14, "html": "{% load verbatim %}\r\n<!DOCTYPE HTML>\r\n<html ng-app=\"Redwood\">\r\n<head>\r\n  <title>Finish</title>\r\n  <script type=\"text/javascript\" src=\"{{ STATIC_URL }}framework/js/lib/jquery/jquery.min.js\"></script>\r\n  <script type=\"text/javascript\" src=\"{{ STATIC_URL }}framework/js/lib/bootstrap/bootstrap-3.1.1.min.js\"></script>\r\n  <script type=\"text/javascript\" src=\"{{ STATIC_URL }}framework/js/lib/angular/angular-1.2.16.js\"></script>\r\n  <script type=\"text/javascript\" src=\"{{ STATIC_URL }}framework/js/redwoodCore.js\"></script>\r\n\t<script type=\"text/javascript\" src=\"{{ STATIC_URL }}framework/js/redwoodHelpers.js\"></script>\r\n\t<script type=\"text/javascript\" src=\"{{ STATIC_URL }}framework/js/redwoodSubject.js\"></script>\r\n\t<link type=\"text/css\" rel=\"stylesheet\" href=\"{{ STATIC_URL }}framework/css/bootstrap-3.1.1.min.css\"></link>\r\n  <script type=\"text/javascript\">\r\n\t\t{{ js }}\r\n\t</script>\r\n\t<style type=\"text/css\">\r\n\t\t{{ css }}\r\n\t</style>\r\n</head>\r\n{% verbatim %}\r\n<body ng-controller=\"SubjectCtrl\" style=\"padding-top:60px;\">\r\n\t\r\n\t<div class=\"navbar navbar-fixed-top container\">\r\n  <div class=\"navbar navbar-default\" style=\"margin-bottom: 0;\">\r\n\t\t<div class=\"navbar-brand\" href=\"#\">Economics Experiment</div>\r\n\t\t<ul class=\"nav navbar-nav\">\r\n\t\t\t<li class=\"active\">\r\n\t\t\t\t<a>User ID: <span>{{$root.user_id}}</span></a>\r\n\t\t\t</li>\r\n\t\t</ul>\r\n\t</div>\r\n</div>\r\n\t\r\n\t<div class=\"container\">\r\n  \t<table class=\"table table-bordered table-condensed\">\r\n\t\t\t<thead>\r\n\t\t\t\t<tr><th>Period</th><th>X</th><th>Y</th><th>Chosen</th><th>Earnings</th></tr>\r\n\t\t\t</thead>\r\n\t\t\t<tbody id=\"results\">\r\n\t\t\t\r\n\t\t\t</tbody>\r\n\t\t</table>\r\n\t</div>\r\n</body>\r\n{% endverbatim %}\r\n</html>\r\n\r\n", "name": "Finish", "css": "", "js": "Redwood.controller(\"SubjectCtrl\", [\"$rootScope\", \"$scope\", \"RedwoodSubject\", function($rootScope, $scope, rs) {\r\n  \r\n  var state = {};\r\n\r\n  rs.on_load(function() {\r\n\t\t\r\n\t\tvar random = Math.random(); //Clear random seed. Kept getting same value without this - weird.\r\n\t\trs.trigger(\"selected_period\", Math.floor(Math.random()*(rs.period - 1)) + 1);\r\n\t\t\r\n\t});\r\n\t\r\n\trs.on(\"selected_period\", function(period) {\r\n\t\t\r\n\t\tvar results = rs.subject[rs.user_id].data[\"results\"];\r\n\t\t\r\n\t\tvar totalPoints = 0;\r\n\t\t\r\n\t\tfor (var i = 0; i < results.length; i++) {\r\n\t\t\t\tvar points = 0;\r\n\t\t\t\tif((i + 1) == period) {\r\n\t\t\t\t\tpoints = results[i].chosen === \"x\" ? results[i].x : results[i].y;\r\n\t\t\t\t\trs.add_points(points);\r\n\t\t\t\t\ttotalPoints += points;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tvar row = '<tr ' + (((i + 1) == period) ? 'class=\"warning\"' : '') + '><td>' + (i + 1) + '</td><td>' + results[i].x.toFixed(2) + '</td><td>' + results[i].y.toFixed(2) + '</td><td>' + results[i].chosen + '</td><td>$' + points.toFixed(2) + '</td></tr>';\r\n\t\t\t\t$(\"#results\").append(row);\r\n\r\n\t\t}\r\n\t\t\r\n\t\tvar row = '<tr class=\"success\" style=\"font-weight:bold;\"><td>Total</td><td></td><td></td><td></td><td>$' + totalPoints.toFixed(2) + '</td></tr>';\r\n\t\t$(\"#results\").append(row);\r\n\t});\r\n  \r\n}]);"}}]